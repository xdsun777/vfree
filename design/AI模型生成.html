<!doctype html>
<html lang="zh">
    <head>
        <meta charset="utf-8" />
        <meta content="width=device-width, initial-scale=1.0" name="viewport" />
        <title>移动端聊天应用</title>
        <!-- Tailwind CSS CDN -->
        <script src="https://cdn.tailwindcss.com"></script>
        <!-- Font Awesome CDN -->
        <link
            href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css"
            rel="stylesheet"
        />
        <style>
            /* 自定义滚动条样式 */
            .custom-scrollbar::-webkit-scrollbar {
                width: 4px;
            }
            .custom-scrollbar::-webkit-scrollbar-track {
                background: #f1f1f1;
            }
            .custom-scrollbar::-webkit-scrollbar-thumb {
                background: #888;
                border-radius: 2px;
            }
            .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                background: #555;
            }
            /* 隐藏默认的数字输入框箭头 */
            input[type='number']::-webkit-outer-spin-button,
            input[type='number']::-webkit-inner-spin-button {
                -webkit-appearance: none;
                margin: 0;
            }
            input[type='number'] {
                -moz-appearance: textfield;
            }
            /* 聊天项滑动效果 */
            .chat-item-wrapper {
                position: relative;
                overflow: hidden;
            }
            .chat-item-content {
                transition: transform 0.3s ease-out;
            }
            .chat-item-actions {
                position: absolute;
                top: 0;
                right: 0;
                height: 100%;
                display: flex;
                align-items: center;
                transform: translateX(100%);
                transition: transform 0.3s ease-out;
            }
            .chat-item-wrapper.swiped .chat-item-content {
                transform: translateX(-120px); /* 两个按钮宽度 */
            }
            .chat-item-wrapper.swiped .chat-item-actions {
                transform: translateX(0);
            }
        </style>
    </head>
    <body
        class="h-screen overflow-hidden bg-gray-100 transition-colors duration-300 dark:bg-gray-900"
    >
        <!-- 主内容区域 -->
        <div
            id="mainContent"
            class="relative flex h-full w-full flex-col transition-all duration-300 ease-in-out"
        >
            <!-- 顶部栏 -->
            <div
                class="relative z-10 flex items-center justify-between bg-white p-4 shadow-md dark:bg-gray-800"
            >
                <!-- 左侧菜单按钮/返回按钮 -->
                <button
                    id="menuToggle"
                    class="text-2xl text-gray-600 focus:outline-none dark:text-gray-300"
                >
                    <i class="fas fa-bars"></i>
                </button>
                <button
                    id="searchBackBtn"
                    class="hidden text-2xl text-gray-600 focus:outline-none dark:text-gray-300"
                >
                    <i class="fas fa-arrow-left"></i>
                </button>
                <!-- 应用名称/搜索输入框 -->
                <div
                    id="appName"
                    class="text-xl font-semibold text-gray-800 transition-opacity duration-300 dark:text-white"
                >
                    聊天
                </div>
                <div id="searchBar" class="mx-4 hidden flex-grow">
                    <input
                        type="text"
                        id="searchInput"
                        placeholder="搜索聊天..."
                        class="w-full rounded-lg bg-gray-100 p-2 text-gray-800 focus:ring-2 focus:ring-blue-500 focus:outline-none dark:bg-gray-700 dark:text-white"
                    />
                </div>
                <!-- 右侧搜索图标 -->
                <button
                    id="searchIcon"
                    class="text-2xl text-gray-600 focus:outline-none dark:text-gray-300"
                >
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <!-- 导航标签 -->
            <div
                class="flex justify-around border-b border-gray-200 bg-white dark:border-gray-700 dark:bg-gray-800"
            >
                <button
                    id="tabConversations"
                    class="flex-1 border-b-2 border-blue-600 py-3 text-center text-lg font-medium text-blue-600 focus:outline-none dark:border-blue-400 dark:text-blue-400"
                >
                    对话
                </button>
                <button
                    id="tabBeauty"
                    class="flex-1 py-3 text-center text-lg font-medium text-gray-500 focus:outline-none dark:text-gray-400"
                >
                    美人阁
                </button>
            </div>
            <!-- 聊天列表区域 -->
            <div
                id="chatListContainer"
                class="custom-scrollbar flex-1 overflow-y-auto p-4"
            >
                <!-- 聊天列表项将通过JS动态生成 -->
            </div>
            <!-- 新建聊天按钮 -->
            <button
                id="newChatBtn"
                class="fixed right-6 bottom-6 z-20 rounded-full bg-blue-600 p-4 text-2xl text-white shadow-lg focus:outline-none"
            >
                <i class="fas fa-plus"></i>
            </button>
        </div>
        <!-- 侧边菜单 -->
        <div
            id="mobileMenu"
            class="custom-scrollbar fixed top-0 left-0 z-50 flex h-full w-64 -translate-x-full transform flex-col overflow-y-auto bg-white shadow-lg transition-transform duration-300 ease-in-out dark:bg-gray-800"
        >
            <!-- 菜单顶部区域 -->
            <div
                class="flex items-center justify-between border-b border-gray-200 p-6 dark:border-gray-700"
            >
                <div class="flex items-center space-x-3">
                    <img
                        alt="用户头像"
                        class="h-12 w-12 rounded-full border-2 border-gray-300 object-cover dark:border-gray-600"
                        src="https://design.gemcoder.com/staticResource/echoAiSystemImages/497c23f38dd05af57919501ec8fcf95d.png"
                    />
                    <span
                        class="text-xl font-semibold text-gray-800 dark:text-white"
                        >xl</span
                    >
                </div>
                <!-- 关闭按钮 -->
                <button
                    id="closeMenu"
                    class="text-gray-500 hover:text-gray-700 focus:outline-none dark:text-gray-400 dark:hover:text-gray-200"
                >
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <!-- 菜单项列表 -->
            <nav class="flex-grow py-4">
                <ul>
                    <li class="border-b border-gray-200 dark:border-gray-700">
                        <a
                            class="flex items-center p-4 text-gray-700 transition-colors duration-200 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"
                            href="javascript:void(0);"
                        >
                            <i class="fas fa-home mr-4 w-6 text-lg"></i>
                            <span class="text-base">主页</span>
                        </a>
                    </li>
                    <li class="border-b border-gray-200 dark:border-gray-700">
                        <a
                            class="flex items-center p-4 text-gray-700 transition-colors duration-200 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"
                            href="javascript:void(0);"
                        >
                            <i class="fas fa-users mr-4 w-6 text-lg"></i>
                            <span class="text-base">新建群组</span>
                        </a>
                    </li>
                    <li class="border-b border-gray-200 dark:border-gray-700">
                        <a
                            class="flex items-center p-4 text-gray-700 transition-colors duration-200 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"
                            href="javascript:void(0);"
                        >
                            <i class="fas fa-address-book mr-4 w-6 text-lg"></i>
                            <span class="text-base">联系人</span>
                            <span
                                class="ml-auto rounded-full bg-blue-500 px-2 py-1 text-xs font-bold text-white"
                                >48</span
                            >
                        </a>
                    </li>
                    <li class="border-b border-gray-200 dark:border-gray-700">
                        <a
                            class="flex items-center p-4 text-gray-700 transition-colors duration-200 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"
                            href="javascript:void(0);"
                        >
                            <i class="fas fa-phone mr-4 w-6 text-lg"></i>
                            <span class="text-base">通话呼叫</span>
                            <span
                                class="ml-auto rounded-full bg-red-500 px-2 py-1 text-xs font-bold text-white"
                                >2</span
                            >
                        </a>
                    </li>
                    <li class="border-b border-gray-200 dark:border-gray-700">
                        <a
                            class="flex items-center p-4 text-gray-700 transition-colors duration-200 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"
                            href="javascript:void(0);"
                        >
                            <i class="fas fa-star mr-4 w-6 text-lg"></i>
                            <span class="text-base">收藏夹</span>
                        </a>
                    </li>
                    <li class="border-b border-gray-200 dark:border-gray-700">
                        <a
                            class="flex items-center p-4 text-gray-700 transition-colors duration-200 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"
                            href="javascript:void(0);"
                        >
                            <i class="fas fa-cog mr-4 w-6 text-lg"></i>
                            <span class="text-base">设置</span>
                        </a>
                    </li>
                    <li class="border-b border-gray-200 dark:border-gray-700">
                        <a
                            class="flex items-center p-4 text-gray-700 transition-colors duration-200 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"
                            href="javascript:void(0);"
                        >
                            <i class="fas fa-user-plus mr-4 w-6 text-lg"></i>
                            <span class="text-base">邀请朋友</span>
                        </a>
                    </li>
                    <li>
                        <a
                            class="flex items-center p-4 text-gray-700 transition-colors duration-200 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"
                            href="javascript:void(0);"
                        >
                            <i class="fas fa-lightbulb mr-4 w-6 text-lg"></i>
                            <span class="text-base">锦囊妙计</span>
                        </a>
                    </li>
                </ul>
            </nav>
            <!-- 主题切换按钮 -->
            <div
                class="flex justify-center border-t border-gray-200 p-4 dark:border-gray-700"
            >
                <button
                    id="themeToggle"
                    class="rounded-full bg-gray-200 p-3 text-gray-700 focus:outline-none dark:bg-gray-700 dark:text-gray-300"
                >
                    <i class="fas fa-moon text-xl" id="themeIcon"></i>
                </button>
            </div>
        </div>
        <!-- 菜单覆盖层 -->
        <div
            id="menuOverlay"
            class="bg-opacity-50 fixed inset-0 z-40 hidden bg-black opacity-0 transition-opacity duration-300 ease-in-out"
        ></div>
        <!-- 搜索结果模态框 -->
        <div
            id="searchResultsModal"
            class="fixed inset-0 z-50 flex hidden flex-col bg-white dark:bg-gray-900"
        >
            <div
                class="flex items-center justify-between border-b border-gray-200 p-4 dark:border-gray-700"
            >
                <h2 class="text-xl font-semibold text-gray-800 dark:text-white">
                    搜索结果
                </h2>
                <button
                    id="closeSearchResults"
                    class="text-2xl text-gray-500 focus:outline-none dark:text-gray-400"
                >
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div
                id="searchResultsList"
                class="custom-scrollbar flex-1 overflow-y-auto p-4"
            >
                <!-- 搜索结果将通过JS动态生成 -->
                <p
                    class="py-4 text-center text-gray-500 dark:text-gray-400"
                    id="noSearchResults"
                >
                    暂无结果
                </p>
            </div>
        </div>
        <!-- 新建聊天模态框 -->
        <div
            id="newChatModal"
            class="bg-opacity-50 fixed inset-0 z-50 flex hidden items-center justify-center bg-black"
        >
            <div
                class="w-11/12 max-w-md rounded-lg bg-white p-6 shadow-xl dark:bg-gray-800"
            >
                <h2
                    class="mb-4 text-xl font-semibold text-gray-800 dark:text-white"
                >
                    新建聊天
                </h2>
                <input
                    type="number"
                    id="newChatIdInput"
                    placeholder="请输入聊天ID"
                    class="mb-4 w-full rounded-lg border border-gray-300 bg-gray-50 p-3 text-gray-800 focus:ring-2 focus:ring-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white"
                />
                <p
                    id="newChatStatus"
                    class="mb-4 hidden text-center text-sm text-gray-600 dark:text-gray-400"
                ></p>
                <div class="flex justify-end space-x-4">
                    <button
                        id="cancelNewChat"
                        class="rounded-lg bg-gray-200 px-4 py-2 text-gray-800 hover:bg-gray-300 focus:outline-none dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600"
                    >
                        取消
                    </button>
                    <button
                        id="connectNewChat"
                        class="rounded-lg bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 focus:outline-none"
                    >
                        连接
                    </button>
                </div>
            </div>
        </div>
        <!-- 聊天详情页面 -->
        <div
            id="chatDetailPage"
            class="fixed inset-0 z-30 flex hidden flex-col bg-white dark:bg-gray-900"
        >
            <!-- 聊天详情顶部栏 -->
            <div
                class="flex items-center border-b border-gray-200 bg-white p-4 shadow-md dark:border-gray-700 dark:bg-gray-800"
            >
                <button
                    id="backToChatList"
                    class="mr-4 text-2xl text-gray-600 focus:outline-none dark:text-gray-300"
                >
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="flex flex-1 items-center space-x-3">
                    <img
                        id="chatDetailAvatar"
                        alt="聊天对象头像"
                        class="h-10 w-10 rounded-full border-2 border-gray-300 object-cover dark:border-gray-600"
                        src="https://design.gemcoder.com/staticResource/echoAiSystemImages/e38843a8879bb3e2af06d23715806a06.png"
                    />
                    <div>
                        <h2
                            id="chatDetailName"
                            class="text-lg font-semibold text-gray-800 dark:text-white"
                        ></h2>
                        <p
                            id="chatDetailStatus"
                            class="text-sm text-gray-500 dark:text-gray-400"
                        ></p>
                    </div>
                </div>
                <div class="flex space-x-4">
                    <button
                        class="text-xl text-gray-600 focus:outline-none dark:text-gray-300"
                    >
                        <i class="fas fa-phone"></i>
                    </button>
                    <button
                        class="text-xl text-gray-600 focus:outline-none dark:text-gray-300"
                    >
                        <i class="fas fa-video"></i>
                    </button>
                    <button
                        class="text-xl text-gray-600 focus:outline-none dark:text-gray-300"
                    >
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                </div>
            </div>
            <!-- 聊天消息区域 -->
            <div
                id="chatMessages"
                class="custom-scrollbar flex-1 space-y-4 overflow-y-auto p-4"
            >
                <!-- 消息将通过JS动态生成 -->
            </div>
            <!-- 消息输入区域 -->
            <div
                class="flex items-center border-t border-gray-200 bg-white p-4 dark:border-gray-700 dark:bg-gray-800"
            >
                <button
                    class="mr-3 text-xl text-gray-600 focus:outline-none dark:text-gray-300"
                >
                    <i class="fas fa-plus-circle"></i>
                </button>
                <input
                    type="text"
                    id="messageInput"
                    placeholder="输入消息..."
                    class="flex-1 rounded-full bg-gray-100 p-3 text-gray-800 focus:ring-2 focus:ring-blue-500 focus:outline-none dark:bg-gray-700 dark:text-white"
                />
                <button
                    id="sendMessageBtn"
                    class="ml-3 rounded-full bg-blue-600 p-3 text-white focus:outline-none"
                >
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const menuToggle = document.getElementById('menuToggle');
                const mobileMenu = document.getElementById('mobileMenu');
                const menuOverlay = document.getElementById('menuOverlay');
                const closeMenuButton = document.getElementById('closeMenu');
                const mainContent = document.getElementById('mainContent');
                const themeToggle = document.getElementById('themeToggle');
                const themeIcon = document.getElementById('themeIcon');
                const searchIcon = document.getElementById('searchIcon');
                const searchBar = document.getElementById('searchBar');
                const searchInput = document.getElementById('searchInput');
                const appName = document.getElementById('appName');
                const searchBackBtn = document.getElementById('searchBackBtn');
                const searchResultsModal =
                    document.getElementById('searchResultsModal');
                const searchResultsList =
                    document.getElementById('searchResultsList');
                const closeSearchResultsBtn =
                    document.getElementById('closeSearchResults');
                const noSearchResults =
                    document.getElementById('noSearchResults');
                const tabConversations =
                    document.getElementById('tabConversations');
                const tabBeauty = document.getElementById('tabBeauty');
                const chatListContainer =
                    document.getElementById('chatListContainer');
                const newChatBtn = document.getElementById('newChatBtn');
                const newChatModal = document.getElementById('newChatModal');
                const newChatIdInput =
                    document.getElementById('newChatIdInput');
                const newChatStatus = document.getElementById('newChatStatus');
                const cancelNewChatBtn =
                    document.getElementById('cancelNewChat');
                const connectNewChatBtn =
                    document.getElementById('connectNewChat');
                const chatDetailPage =
                    document.getElementById('chatDetailPage');
                const backToChatListBtn =
                    document.getElementById('backToChatList');
                const chatDetailAvatar =
                    document.getElementById('chatDetailAvatar');
                const chatDetailName =
                    document.getElementById('chatDetailName');
                const chatDetailStatus =
                    document.getElementById('chatDetailStatus');
                const chatMessages = document.getElementById('chatMessages');
                const messageInput = document.getElementById('messageInput');
                const sendMessageBtn =
                    document.getElementById('sendMessageBtn');
                let currentTheme = localStorage.getItem('theme') || 'light';
                let chats = [
                    {
                        id: 1,
                        name: '张三',
                        lastMessage: '你好，最近怎么样？',
                        time: '10:30',
                        unread: 2,
                        isFavorite: false,
                        status: 'online',
                    },
                    {
                        id: 2,
                        name: '李四',
                        lastMessage: '好的，没问题。',
                        time: '昨天',
                        unread: 0,
                        isFavorite: true,
                        status: 'offline',
                    },
                    {
                        id: 3,
                        name: '王五',
                        lastMessage: '收到，谢谢！',
                        time: '周一',
                        unread: 1,
                        isFavorite: false,
                        status: 'online',
                    },
                    {
                        id: 4,
                        name: '赵六',
                        lastMessage: '稍后回复你。',
                        time: '上周',
                        unread: 0,
                        isFavorite: false,
                        status: 'offline',
                    },
                    {
                        id: 5,
                        name: '钱七',
                        lastMessage: '好的，没问题。',
                        time: '昨天',
                        unread: 0,
                        isFavorite: true,
                        status: 'offline',
                    },
                    {
                        id: 6,
                        name: '孙八',
                        lastMessage: '收到，谢谢！',
                        time: '周一',
                        unread: 1,
                        isFavorite: false,
                        status: 'online',
                    },
                    {
                        id: 7,
                        name: '周九',
                        lastMessage: '稍后回复你。',
                        time: '上周',
                        unread: 0,
                        isFavorite: false,
                        status: 'offline',
                    },
                ];
                // 模拟聊天消息
                const mockMessages = {
                    1: [
                        {
                            type: 'received',
                            content: '你好，最近怎么样？',
                            time: '10:28',
                        },
                        {
                            type: 'sent',
                            content: '挺好的，你呢？',
                            time: '10:29',
                        },
                        {
                            type: 'received',
                            content: '我也很好，有空一起吃饭？',
                            time: '10:30',
                        },
                    ],
                    2: [
                        {
                            type: 'received',
                            content: '项目进展如何？',
                            time: '昨天 14:00',
                        },
                        {
                            type: 'sent',
                            content: '一切顺利，已按计划完成。',
                            time: '昨天 14:05',
                        },
                        {
                            type: 'received',
                            content: '好的，没问题。',
                            time: '昨天 14:10',
                        },
                    ],
                    3: [
                        {
                            type: 'received',
                            content: '请查收附件。',
                            time: '周一 09:00',
                        },
                        {
                            type: 'sent',
                            content: '收到，谢谢！',
                            time: '周一 09:05',
                        },
                    ],
                };
                // --- 页面加载与初始化 ---
                const initializePage = () => {
                    // 导航标签：默认选中“对话”
                    tabConversations.classList.add(
                        'text-blue-600',
                        'dark:text-blue-400',
                        'border-blue-600',
                        'dark:border-blue-400',
                    );
                    tabBeauty.classList.remove(
                        'text-blue-600',
                        'dark:text-blue-400',
                        'border-blue-600',
                        'dark:border-blue-400',
                    );
                    tabConversations.classList.remove(
                        'text-gray-500',
                        'dark:text-gray-400',
                    );
                    tabBeauty.classList.add(
                        'text-gray-500',
                        'dark:text-gray-400',
                    );
                    // 侧边导航栏：初始状态为隐藏 (通过CSS transform控制)
                    // 主题切换
                    applyTheme(currentTheme);
                    // 搜索功能：初始状态为隐藏搜索栏
                    searchBar.classList.add('hidden');
                    appName.classList.remove('hidden');
                    searchBackBtn.classList.add('hidden');
                    searchIcon.classList.remove('hidden');
                    // 新建聊天模态框初始状态为隐藏
                    // 聊天列表状态：随机为聊天列表中的每个聊天项分配“在线”或“离线”状态
                    chats.forEach((chat) => {
                        chat.status =
                            Math.random() < 0.7 ? 'online' : 'offline'; // 70% 在线
                    });
                    renderChatList(chats);
                };
                // --- 主题切换功能 ---
                const applyTheme = (theme) => {
                    if (theme === 'dark') {
                        document.documentElement.classList.add('dark');
                        themeIcon.classList.remove('fa-moon');
                        themeIcon.classList.add('fa-sun');
                    } else {
                        document.documentElement.classList.remove('dark');
                        themeIcon.classList.remove('fa-sun');
                        themeIcon.classList.add('fa-moon');
                    }
                    localStorage.setItem('theme', theme);
                    currentTheme = theme;
                };
                themeToggle.addEventListener('click', () => {
                    const newTheme =
                        currentTheme === 'light' ? 'dark' : 'light';
                    applyTheme(newTheme);
                });
                // --- 侧边导航栏功能 ---
                const openMenu = () => {
                    mobileMenu.classList.remove('-translate-x-full');
                    mobileMenu.classList.add('translate-x-0');
                    menuOverlay.classList.remove('hidden');
                    setTimeout(() => {
                        menuOverlay.classList.add('opacity-100');
                    }, 10);
                    mainContent.classList.add(
                        'filter',
                        'blur-sm',
                        'pointer-events-none',
                    );
                };
                const closeMenu = () => {
                    mobileMenu.classList.remove('translate-x-0');
                    mobileMenu.classList.add('-translate-x-full');
                    menuOverlay.classList.remove('opacity-100');
                    setTimeout(() => {
                        menuOverlay.classList.add('hidden');
                    }, 300);
                    mainContent.classList.remove(
                        'filter',
                        'blur-sm',
                        'pointer-events-none',
                    );
                };
                menuToggle.addEventListener('click', openMenu);
                menuOverlay.addEventListener('click', closeMenu);
                closeMenuButton.addEventListener('click', closeMenu);
                // --- 顶部栏与搜索功能 ---
                searchIcon.addEventListener('click', () => {
                    appName.classList.add('hidden');
                    searchIcon.classList.add('hidden');
                    searchBar.classList.remove('hidden');
                    searchBackBtn.classList.remove('hidden');
                    searchInput.focus();
                });
                searchBackBtn.addEventListener('click', () => {
                    searchBar.classList.add('hidden');
                    searchBackBtn.classList.add('hidden');
                    appName.classList.remove('hidden');
                    searchIcon.classList.remove('hidden');
                    searchInput.value = ''; // 清空搜索框
                    searchResultsModal.classList.add('hidden'); // 隐藏搜索结果模态框
                });
                searchInput.addEventListener('keypress', (event) => {
                    if (event.key === 'Enter') {
                        performSearch();
                    }
                });
                const performSearch = () => {
                    const query = searchInput.value.trim();
                    if (!query) {
                        alert('请输入搜索内容！');
                        return;
                    }
                    const results = chats.filter(
                        (chat) =>
                            chat.name.includes(query) ||
                            chat.lastMessage.includes(query) ||
                            String(chat.id).includes(query),
                    );
                    searchResultsList.innerHTML = ''; // 清空旧结果
                    if (results.length === 0) {
                        noSearchResults.classList.remove('hidden');
                    } else {
                        noSearchResults.classList.add('hidden');
                        results.forEach((chat) => {
                            const resultItem = document.createElement('div');
                            resultItem.classList.add(
                                'p-3',
                                'border-b',
                                'border-gray-200',
                                'dark:border-gray-700',
                                'flex',
                                'items-center',
                                'space-x-3',
                                'cursor-pointer',
                                'hover:bg-gray-100',
                                'dark:hover:bg-gray-700',
                            );
                            resultItem.innerHTML = `
                        <img alt="用户头像" class="w-10 h-10 rounded-full object-cover" src="https://design.gemcoder.com/staticResource/echoAiSystemImages/42a4bfc64227265acd97da236caa27e1.png"/>
                        <div>
                            <p class="font-semibold text-gray-800 dark:text-white">${chat.name} (ID: ${chat.id})</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400 truncate">${chat.lastMessage}</p>
                        </div>
                    `;
                            resultItem.addEventListener('click', () => {
                                searchResultsModal.classList.add('hidden');
                                enterChatDetail(chat.id);
                            });
                            searchResultsList.appendChild(resultItem);
                        });
                    }
                    searchResultsModal.classList.remove('hidden');
                };
                closeSearchResultsBtn.addEventListener('click', () => {
                    searchResultsModal.classList.add('hidden');
                });
                // --- 导航标签功能 ---
                tabConversations.addEventListener('click', () => {
                    tabConversations.classList.add(
                        'text-blue-600',
                        'dark:text-blue-400',
                        'border-blue-600',
                        'dark:border-blue-400',
                    );
                    tabBeauty.classList.remove(
                        'text-blue-600',
                        'dark:text-blue-400',
                        'border-blue-600',
                        'dark:border-blue-400',
                    );
                    tabConversations.classList.remove(
                        'text-gray-500',
                        'dark:text-gray-400',
                    );
                    tabBeauty.classList.add(
                        'text-gray-500',
                        'dark:text-gray-400',
                    );
                    // 实际应用中这里可以切换不同的内容区域
                    renderChatList(chats); // 重新渲染对话列表
                });
                tabBeauty.addEventListener('click', () => {
                    tabBeauty.classList.add(
                        'text-blue-600',
                        'dark:text-blue-400',
                        'border-blue-600',
                        'dark:border-blue-400',
                    );
                    tabConversations.classList.remove(
                        'text-blue-600',
                        'dark:text-blue-400',
                        'border-blue-600',
                        'dark:border-blue-400',
                    );
                    tabBeauty.classList.remove(
                        'text-gray-500',
                        'dark:text-gray-400',
                    );
                    tabConversations.classList.add(
                        'text-gray-500',
                        'dark:text-gray-400',
                    );
                    // 实际应用中这里可以切换不同的内容区域，例如显示美人阁内容
                    chatListContainer.innerHTML = `
                <div class="text-center text-gray-500 dark:text-gray-400 py-8">
                    <i class="fas fa-camera fa-3x mb-4"></i>
                    <p class="text-lg">美人阁内容待开发...</p>
                    <p class="text-sm mt-2">敬请期待更多精彩！</p>
                </div>
            `;
                });
                // --- 聊天列表操作 ---
                const renderChatList = (chatData) => {
                    chatListContainer.innerHTML = '';
                    chatData.forEach((chat) => {
                        const chatItemWrapper = document.createElement('div');
                        chatItemWrapper.classList.add(
                            'chat-item-wrapper',
                            'mb-2',
                            'rounded-lg',
                            'overflow-hidden',
                        );
                        const chatItemContent = document.createElement('div');
                        chatItemContent.classList.add(
                            'chat-item-content',
                            'flex',
                            'items-center',
                            'p-3',
                            'bg-white',
                            'dark:bg-gray-800',
                            'shadow-sm',
                            'rounded-lg',
                            'relative',
                            'z-10',
                        );
                        chatItemContent.setAttribute('data-chat-id', chat.id);
                        const statusIndicatorClass =
                            chat.status === 'online'
                                ? 'bg-green-500'
                                : 'bg-gray-400';
                        const unreadBadge =
                            chat.unread > 0
                                ? `<span class="ml-auto bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full">${chat.unread}</span>`
                                : '';
                        const favoriteIconClass = chat.isFavorite
                            ? 'fas fa-star text-yellow-500'
                            : 'far fa-star text-gray-400';
                        chatItemContent.innerHTML = `
                    <div class="relative">
                        <img alt="用户头像" class="w-14 h-14 rounded-full object-cover border-2 border-gray-200 dark:border-gray-700" src="https://design.gemcoder.com/staticResource/echoAiSystemImages/ecc6ba2309c51f7a64cc9d12a80eac87.png"/>
                        <span class="absolute bottom-0 right-0 w-4 h-4 rounded-full border-2 border-white dark:border-gray-800 ${statusIndicatorClass}" title="${chat.status === 'offline' ? '不在线' : '在线'}"></span>
                    </div>
                    <div class="flex-1 ml-4 overflow-hidden">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white truncate">${chat.name}</h3>
                            <span class="text-sm text-gray-500 dark:text-gray-400">${chat.time}</span>
                        </div>
                        <p class="text-gray-600 dark:text-gray-400 text-sm truncate">${chat.lastMessage}</p>
                    </div>
                    <div class="flex items-center ml-4 space-x-2">
                        <button class="edit-chat-btn text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 focus:outline-none" data-chat-id="${chat.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        ${unreadBadge}
                    </div>
                `;
                        const chatItemActions = document.createElement('div');
                        chatItemActions.classList.add(
                            'chat-item-actions',
                            'space-x-2',
                            'pr-3',
                        );
                        chatItemActions.innerHTML = `
                    <button class="delete-chat-btn bg-red-500 text-white p-3 rounded-lg focus:outline-none" data-chat-id="${chat.id}">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                    <button class="favorite-chat-btn bg-yellow-500 text-white p-3 rounded-lg focus:outline-none" data-chat-id="${chat.id}">
                        <i class="${favoriteIconClass}"></i>
                    </button>
                `;
                        chatItemWrapper.appendChild(chatItemContent);
                        chatItemWrapper.appendChild(chatItemActions);
                        chatListContainer.appendChild(chatItemWrapper);
                        // 添加滑动事件监听
                        let startX = 0;
                        let currentX = 0;
                        let isSwiping = false;
                        const threshold = 60; // 滑动距离阈值
                        chatItemContent.addEventListener('touchstart', (e) => {
                            startX = e.touches[0].clientX;
                            currentX = 0;
                            isSwiping = false;
                            // 关闭其他已打开的滑动项
                            document
                                .querySelectorAll('.chat-item-wrapper.swiped')
                                .forEach((item) => {
                                    if (item !== chatItemWrapper) {
                                        item.classList.remove('swiped');
                                    }
                                });
                        });
                        chatItemContent.addEventListener('touchmove', (e) => {
                            currentX = e.touches[0].clientX - startX;
                            if (Math.abs(currentX) > 10) {
                                // 稍微移动一点就认为是滑动
                                isSwiping = true;
                                if (currentX < 0) {
                                    // 向左滑动
                                    chatItemContent.style.transform = `translateX(${Math.max(-120, currentX)}px)`;
                                } else {
                                    // 向右滑动，用于关闭
                                    chatItemContent.style.transform = `translateX(${Math.min(0, currentX)}px)`;
                                }
                            }
                        });
                        chatItemContent.addEventListener('touchend', () => {
                            if (isSwiping) {
                                if (currentX < -threshold) {
                                    // 达到向左滑动阈值
                                    chatItemWrapper.classList.add('swiped');
                                    chatItemContent.style.transform = `translateX(-120px)`;
                                } else if (currentX > threshold) {
                                    // 达到向右滑动阈值 (用于关闭)
                                    chatItemWrapper.classList.remove('swiped');
                                    chatItemContent.style.transform = `translateX(0px)`;
                                } else {
                                    // 未达到阈值，恢复原位
                                    chatItemWrapper.classList.remove('swiped');
                                    chatItemContent.style.transform = `translateX(0px)`;
                                }
                            }
                            isSwiping = false;
                            startX = 0;
                            currentX = 0;
                        });
                        // 阻止点击事件在滑动时触发
                        chatItemContent.addEventListener('click', (e) => {
                            if (chatItemWrapper.classList.contains('swiped')) {
                                e.preventDefault(); // 阻止默认点击行为
                                chatItemWrapper.classList.remove('swiped');
                                chatItemContent.style.transform = `translateX(0px)`;
                            } else if (!isSwiping) {
                                // 只有在没有滑动且没有打开操作按钮时才进入聊天详情
                                const chatId = parseInt(
                                    e.currentTarget.getAttribute(
                                        'data-chat-id',
                                    ),
                                );
                                enterChatDetail(chatId);
                            }
                        });
                    });
                    // 重新绑定事件监听器，因为DOM元素已重新创建
                    attachChatListEventListeners();
                };
                const attachChatListEventListeners = () => {
                    // 编辑聊天项
                    document
                        .querySelectorAll('.edit-chat-btn')
                        .forEach((button) => {
                            button.onclick = (e) => {
                                e.stopPropagation(); // 阻止事件冒泡到父级聊天项
                                const chatId = parseInt(
                                    button.getAttribute('data-chat-id'),
                                );
                                const chat = chats.find((c) => c.id === chatId);
                                if (chat) {
                                    alert(
                                        `编辑聊天：\n用户: ${chat.name}\n消息: ${chat.lastMessage}`,
                                    );
                                }
                            };
                        });
                    // 删除聊天项
                    document
                        .querySelectorAll('.delete-chat-btn')
                        .forEach((button) => {
                            button.onclick = (e) => {
                                e.stopPropagation();
                                const chatId = parseInt(
                                    button.getAttribute('data-chat-id'),
                                );
                                if (
                                    confirm(
                                        `确定要删除与ID为 ${chatId} 的聊天吗？`,
                                    )
                                ) {
                                    chats = chats.filter(
                                        (chat) => chat.id !== chatId,
                                    );
                                    renderChatList(chats); // 重新渲染列表
                                }
                            };
                        });
                    // 收藏/取消收藏聊天项
                    document
                        .querySelectorAll('.favorite-chat-btn')
                        .forEach((button) => {
                            button.onclick = (e) => {
                                e.stopPropagation();
                                const chatId = parseInt(
                                    button.getAttribute('data-chat-id'),
                                );
                                const chat = chats.find((c) => c.id === chatId);
                                if (chat) {
                                    chat.isFavorite = !chat.isFavorite;
                                    alert(
                                        `聊天 ${chat.name} 已${chat.isFavorite ? '收藏' : '取消收藏'}！`,
                                    );
                                    renderChatList(chats); // 重新渲染列表以更新图标
                                }
                            };
                        });
                };
                // --- 进入聊天详情页面 ---
                const enterChatDetail = (chatId) => {
                    const chat = chats.find((c) => c.id === chatId);
                    if (!chat) {
                        alert('聊天不存在！');
                        return;
                    }
                    mainContent.classList.add('hidden');
                    chatDetailPage.classList.remove('hidden');
                    chatDetailName.textContent = chat.name;
                    chatDetailStatus.textContent =
                        chat.status === 'online' ? '在线' : '离线';
                    chatDetailAvatar.src = `https://design.gemcoder.com/staticResource/echoAiSystemImages/42a4bfc64227265acd97da236caa27e1.png`;
                    // 加载模拟消息
                    loadChatMessages(chatId);
                };
                const loadChatMessages = (chatId) => {
                    chatMessages.innerHTML = ''; // 清空旧消息
                    const messages = mockMessages[chatId] || [];
                    messages.forEach((msg) => {
                        const messageDiv = document.createElement('div');
                        messageDiv.classList.add(
                            'flex',
                            msg.type === 'sent'
                                ? 'justify-end'
                                : 'justify-start',
                        );
                        messageDiv.innerHTML = `
                    <div class="max-w-[70%] p-3 rounded-lg ${msg.type === 'sent' ? 'bg-blue-500 text-white' : 'bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white'}">
                        <p>${msg.content}</p>
                        <span class="block text-right text-xs mt-1 ${msg.type === 'sent' ? 'text-blue-100' : 'text-gray-500 dark:text-gray-400'}">${msg.time}</span>
                    </div>
                `;
                        chatMessages.appendChild(messageDiv);
                    });
                    chatMessages.scrollTop = chatMessages.scrollHeight; // 滚动到底部
                };
                backToChatListBtn.addEventListener('click', () => {
                    chatDetailPage.classList.add('hidden');
                    mainContent.classList.remove('hidden');
                });
                sendMessageBtn.addEventListener('click', () => {
                    const messageContent = messageInput.value.trim();
                    if (messageContent) {
                        const now = new Date();
                        const time = `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
                        // 添加发送的消息
                        const sentMessageDiv = document.createElement('div');
                        sentMessageDiv.classList.add('flex', 'justify-end');
                        sentMessageDiv.innerHTML = `
                    <div class="max-w-[70%] p-3 rounded-lg bg-blue-500 text-white">
                        <p>${messageContent}</p>
                        <span class="block text-right text-xs mt-1 text-blue-100">${time}</span>
                    </div>
                `;
                        chatMessages.appendChild(sentMessageDiv);
                        messageInput.value = ''; // 清空输入框
                        chatMessages.scrollTop = chatMessages.scrollHeight; // 滚动到底部
                        // 模拟对方回复
                        setTimeout(() => {
                            const replyMessageDiv =
                                document.createElement('div');
                            replyMessageDiv.classList.add(
                                'flex',
                                'justify-start',
                            );
                            replyMessageDiv.innerHTML = `
                        <div class="max-w-[70%] p-3 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white">
                            <p>好的，我收到了。</p>
                            <span class="block text-right text-xs mt-1 text-gray-500 dark:text-gray-400">${time}</span>
                        </div>
                    `;
                            chatMessages.appendChild(replyMessageDiv);
                            chatMessages.scrollTop = chatMessages.scrollHeight; // 滚动到底部
                        }, 1000);
                    }
                });
                // --- 新建聊天功能 ---
                newChatBtn.addEventListener('click', () => {
                    newChatModal.classList.remove('hidden');
                    newChatIdInput.value = '';
                    newChatStatus.classList.add('hidden');
                    connectNewChatBtn.disabled = false;
                    connectNewChatBtn.classList.remove(
                        'opacity-50',
                        'cursor-not-allowed',
                    );
                });
                cancelNewChatBtn.addEventListener('click', () => {
                    newChatModal.classList.add('hidden');
                });
                connectNewChatBtn.addEventListener('click', () => {
                    const newChatId = newChatIdInput.value.trim();
                    if (!newChatId) {
                        newChatStatus.textContent = '请输入聊天ID！';
                        newChatStatus.classList.remove(
                            'hidden',
                            'text-green-500',
                        );
                        newChatStatus.classList.add('text-red-500');
                        return;
                    }
                    connectNewChatBtn.disabled = true;
                    connectNewChatBtn.classList.add(
                        'opacity-50',
                        'cursor-not-allowed',
                    );
                    newChatStatus.textContent = '连接中...';
                    newChatStatus.classList.remove('hidden', 'text-red-500');
                    newChatStatus.classList.add('text-blue-500');
                    setTimeout(() => {
                        const isSuccess = Math.random() > 0.2; // 模拟80%成功率
                        if (isSuccess) {
                            newChatStatus.textContent = '连接成功！';
                            newChatStatus.classList.remove(
                                'text-red-500',
                                'text-blue-500',
                            );
                            newChatStatus.classList.add('text-green-500');
                            setTimeout(() => {
                                newChatModal.classList.add('hidden');
                                const newChat = {
                                    id: parseInt(newChatId),
                                    name: `新用户 ${newChatId}`,
                                    lastMessage: '我们开始聊天吧！',
                                    time: '刚刚',
                                    unread: 0,
                                    isFavorite: false,
                                    status: 'online',
                                };
                                // 检查是否已存在，如果存在则更新，否则添加
                                const existingChatIndex = chats.findIndex(
                                    (c) => c.id === newChat.id,
                                );
                                if (existingChatIndex !== -1) {
                                    chats[existingChatIndex] = newChat;
                                } else {
                                    chats.unshift(newChat); // 添加到列表开头
                                }
                                renderChatList(chats);
                                enterChatDetail(newChat.id);
                            }, 1000);
                        } else {
                            newChatStatus.textContent = '连接失败，请重试。';
                            newChatStatus.classList.remove(
                                'text-green-500',
                                'text-blue-500',
                            );
                            newChatStatus.classList.add('text-red-500');
                            connectNewChatBtn.disabled = false;
                            connectNewChatBtn.classList.remove(
                                'opacity-50',
                                'cursor-not-allowed',
                            );
                        }
                    }, 2000);
                });
                // 页面加载时初始化渲染
                initializePage();
            });
        </script>
    </body>
</html>
